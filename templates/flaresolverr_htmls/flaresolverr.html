{% extends "base.html" %}

{% block title %}FlareSolverr ç®¡ç†é¢æ¿{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/vulnerability/vulnerability.css') }}">
{% endblock %}

{% block content %}
<div class="flaresolverr-container">
    <div class="container">
        <div class="flaresolverr-main">
            <!-- é ­éƒ¨ -->
            <div class="flaresolverr-header">
                <h1>ğŸ”¥ FlareSolverr ç®¡ç†é¢æ¿</h1>
                <p>Cloudflare é©—è­‰ç¢¼è§£æ±ºæ–¹æ¡ˆç®¡ç†å·¥å…·</p>
            </div>
            
            <!-- å…§å®¹å€åŸŸ -->
            <div class="flaresolverr-content">
                <!-- ç‹€æ…‹å¡ç‰‡ -->
                <div class="status-card">
                    <h2>
                        <i class="fas fa-server me-2"></i>æœå‹™ç‹€æ…‹
                        <div class="form-check form-switch float-end">
                            <input class="form-check-input" type="checkbox" id="auto-refresh-toggle" checked>
                            <label class="form-check-label" for="auto-refresh-toggle">
                                è‡ªå‹•åˆ·æ–°
                            </label>
                        </div>
                    </h2>
                    <div id="status-info">
                        <div class="loading loading-dark"></div> æ­£åœ¨è¼‰å…¥ç‹€æ…‹...
                    </div>
                </div>
                
                <!-- æ§åˆ¶æŒ‰éˆ• -->
                <div class="controls">
                    <!-- æ¸¬è©¦æŒ‰éˆ• -->
                    <button class="flaresolverr-btn btn-refresh" onclick="alert('æ¸¬è©¦æŒ‰éˆ•å·¥ä½œæ­£å¸¸ï¼'); console.log('å…§è¯æ¸¬è©¦æŒ‰éˆ•è¢«é»æ“Š');">
                        <i class="fas fa-bug me-2"></i>
                        <span>æ¸¬è©¦æŒ‰éˆ•</span>
                    </button>
                    
                    <button class="flaresolverr-btn btn-start" id="start-service-btn">
                        <i class="fas fa-play me-2"></i>
                        <span>å•Ÿå‹•æœå‹™</span>
                    </button>
                    <button class="flaresolverr-btn btn-stop" id="stop-service-btn">
                        <i class="fas fa-stop me-2"></i>
                        <span>åœæ­¢æœå‹™</span>
                    </button>
                    <button class="flaresolverr-btn btn-restart" id="restart-service-btn">
                        <i class="fas fa-redo me-2"></i>
                        <span>é‡å•Ÿæœå‹™</span>
                    </button>
                    <button class="flaresolverr-btn btn-refresh" id="refresh-status-btn">
                        <i class="fas fa-sync me-2"></i>
                        <span>åˆ·æ–°ç‹€æ…‹</span>
                    </button>
                </div>
                
                <!-- ä¿¡æ¯ç¶²æ ¼ -->
                <div class="info-grid" id="info-grid">
                    <!-- å‹•æ…‹è¼‰å…¥æœå‹™ä¿¡æ¯ -->
                </div>
                
                <!-- æ¸¬è©¦å€åŸŸ -->
                <div class="test-section">
                    <h2>
                        <i class="fas fa-flask me-2"></i>æ¸¬è©¦ FlareSolverr
                    </h2>
                    <div class="row">
                        <div class="col-md-8">
                            <input 
                                type="url" 
                                class="test-input" 
                                id="test-url" 
                                placeholder="è¼¸å…¥è¦æ¸¬è©¦çš„ URL (ä¾‹: https://example.com)"
                                value="https://httpbin.org/get"
                            >
                        </div>
                        <div class="col-md-4">
                            <button class="flaresolverr-btn btn-start w-100" id="test-solve-btn">
                                <i class="fas fa-vial me-2"></i>
                                <span>æ¸¬è©¦è§£æ</span>
                            </button>
                        </div>
                    </div>
                    <div id="test-result" class="test-result" style="display: none;"></div>
                </div>
                
                <!-- ä½¿ç”¨èªªæ˜ -->
                <div class="test-section mt-4">
                    <h2>
                        <i class="fas fa-info-circle me-2"></i>ä½¿ç”¨èªªæ˜
                    </h2>
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-cogs me-2"></i>åŠŸèƒ½ç‰¹è‰²</h5>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>è‡ªå‹•å•Ÿå‹•å’Œåœæ­¢æœå‹™</li>
                                <li><i class="fas fa-check text-success me-2"></i>å¯¦æ™‚ç‹€æ…‹ç›£æ§</li>
                                <li><i class="fas fa-check text-success me-2"></i>è‡ªå‹•é‡å•Ÿæ©Ÿåˆ¶</li>
                                <li><i class="fas fa-check text-success me-2"></i>é€²ç¨‹è³‡æºç›£æ§</li>
                                <li><i class="fas fa-check text-success me-2"></i>Web ç®¡ç†ç•Œé¢</li>
                                <li><i class="fas fa-check text-success me-2"></i>Cloudflare é©—è­‰ç¢¼è§£æ±º</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-link me-2"></i>API ç«¯é»</h5>
                            <ul class="list-unstyled">
                                <li><code>POST /api/flaresolverr/start</code> - å•Ÿå‹•æœå‹™</li>
                                <li><code>POST /api/flaresolverr/stop</code> - åœæ­¢æœå‹™</li>
                                <li><code>POST /api/flaresolverr/restart</code> - é‡å•Ÿæœå‹™</li>
                                <li><code>GET /api/flaresolverr/status</code> - ç²å–ç‹€æ…‹</li>
                                <li><code>POST /api/flaresolverr/solve</code> - è§£æ±ºé©—è­‰ç¢¼</li>
                                <li><code>GET /api/flaresolverr/help</code> - ç²å–å¹«åŠ©</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <h6><i class="fas fa-lightbulb me-2"></i>æç¤º</h6>
                        <p class="mb-0">
                            FlareSolverr æ˜¯ä¸€å€‹ä»£ç†æœå‹™å™¨ï¼Œç”¨æ–¼ç¹é Cloudflare å’Œ DDoS-GUARD ä¿è­·ã€‚
                            å®ƒå•Ÿå‹•ä¸€å€‹ä»£ç†æœå‹™å™¨ï¼Œä¸¦ä½¿ç”¨ç„¡é ­ Chrome ç€è¦½å™¨å’Œ undetected-chromedriver ä¾†è§£æ±ºæŒ‘æˆ°ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é€šçŸ¥å®¹å™¨ -->
<div id="notification" class="notification"></div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/vulnerability.js') }}"></script>
<script>
// èª¿è©¦è…³æœ¬ - æª¢æŸ¥ JavaScript æ˜¯å¦æ­£ç¢ºè¼‰å…¥
console.log('èª¿è©¦: HTML æ¨¡æ¿è…³æœ¬å·²è¼‰å…¥');

// æª¢æŸ¥ DOM æ˜¯å¦å·²æº–å‚™å¥½
if (document.readyState === 'loading') {
    console.log('èª¿è©¦: DOM ä»åœ¨è¼‰å…¥ä¸­');
    document.addEventListener('DOMContentLoaded', function() {
        console.log('èª¿è©¦: DOM è¼‰å…¥å®Œæˆäº‹ä»¶è§¸ç™¼');
        setTimeout(checkElements, 1000); // å»¶é²æª¢æŸ¥å…ƒç´ 
    });
} else {
    console.log('èª¿è©¦: DOM å·²è¼‰å…¥å®Œæˆ');
    setTimeout(checkElements, 1000); // å»¶é²æª¢æŸ¥å…ƒç´ 
}

function checkElements() {
    console.log('èª¿è©¦: æª¢æŸ¥é é¢å…ƒç´ ...');
    
    const elements = {
        'start-service-btn': document.getElementById('start-service-btn'),
        'stop-service-btn': document.getElementById('stop-service-btn'),
        'restart-service-btn': document.getElementById('restart-service-btn'),
        'refresh-status-btn': document.getElementById('refresh-status-btn'),
        'test-solve-btn': document.getElementById('test-solve-btn'),
        'test-url': document.getElementById('test-url'),
        'auto-refresh-toggle': document.getElementById('auto-refresh-toggle')
    };
    
    console.log('èª¿è©¦: æ‰¾åˆ°çš„å…ƒç´ :', elements);
    
    // æª¢æŸ¥å…¨å±€è®Šé‡
    console.log('èª¿è©¦: å…¨å±€è®Šé‡æª¢æŸ¥:', {
        FlareSolverrManager: typeof window.FlareSolverrManager,
        flaresolverrManager: typeof window.flaresolverrManager
    });
    
    // æ‰‹å‹•æ¸¬è©¦æŒ‰éˆ•é»æ“Š
    const testBtn = document.getElementById('refresh-status-btn');
    if (testBtn) {
        console.log('èª¿è©¦: ç‚ºåˆ·æ–°æŒ‰éˆ•æ·»åŠ æ¸¬è©¦äº‹ä»¶ç›£è½å™¨');
        testBtn.addEventListener('click', function(e) {
            console.log('èª¿è©¦: åˆ·æ–°æŒ‰éˆ•é»æ“Šäº‹ä»¶è§¸ç™¼!');
            e.preventDefault();
            alert('åˆ·æ–°æŒ‰éˆ•è¢«é»æ“Šäº†ï¼');
        });
    }
}
</script>
{% endblock %}